package gov.usdot.cv.security.msg;

import static org.junit.Assert.*;

import gov.usdot.cv.security.clock.ClockHelperTest;
import gov.usdot.cv.security.cert.Certificate;
import gov.usdot.cv.security.cert.CertificateException;
import gov.usdot.cv.security.cert.CertificateManager;
import gov.usdot.cv.security.crypto.CryptoException;
import gov.usdot.cv.security.crypto.CryptoProvider;
import gov.usdot.cv.security.util.UnitTestHelper;
import gov.usdot.cv.security.util.vector.VectorException;

import org.apache.commons.codec.DecoderException;
import org.apache.commons.codec.binary.Hex;
import org.apache.log4j.Logger;
import org.junit.After;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;

public class VehicleMessageTest {

	static final private boolean isDebugOutput = false;
	private static final Logger log = Logger.getLogger(VehicleMessageTest.class);
	
	private static final String certsValidDate = "Tue Oct 14 15:20:00 EDT 2014";
	
	// certificates
    private static final String CaCert   = "02FF040083FF01000100041C374A82000000010102495E407595F995430B820249E71A2A21176CE7135846A5CF2C4E458424C7F8D80200031F0C0A4529071BC12144ED0E71016695F79464A855F5D85CD7863B962C1ABEB000120756A693E756D0EFD05C148FFF99A1F1F23965DEE2C7C4C0A7F795BADF17E3D863334CA409D1F9DB53766ABA0B28D1C79581F0728C57C80240EF029FD96739";
    private static final String RaCert   = "020904AF58634513BE7FFB0100834F010120041C374A82000000010103C0B9E8CB6743BBBD6A483EA2046A300671AB7B7A2D7C2AD6238D348D896D08AD020003CF4C0803B1FF6AA78B0E109837617AE5416E7B263D8245B8CD6868D6813598B9009D1D41B1EB29157C7D868120E9928A2E8190F22784EDA5AE689375E3BE3C2992743282268FDF11AAE92B7FB037FC9A0558143D15D862B0B65DCDA984F65A61D7";

    static final String[] messages = {
    	// BSM live messages (vendor unknown but most likely this is Savari)
		"020103030003af58634513be7ffb011200000566000000ac0cb87c12d590f1ed09e101022000041449cf38014a000000010218ba16a53e7e612febb0719ab3aa6293f19e8a81a1b702aa765fb38e07015e3b022081093082010580010281267468665f0279e0194c68e7ce4478d9093dffffffffe00435ba7f000e07d18100000800000000a281cda181c1820117a381bb8381b800917fd0bf19fffe01547fc51f48fffe017bbfc42f59fffefffb3fb54fe1fffe002fffe1bf90fffeffde7fd4902afffe002effd2d03dfffe009bffaf0011fffeffccffdb500cfffeffdb3fc30002fffe00493fca8f6cfffe009f7fd13f7ffffe00de3fb88f84fffe0119bfb5df07fffe0003ffb2ff7cfffefff1bfe18f73fffe019fbfa4cf0cfffe00343ff05fb9fffeff8f40226feefffeff84802bbfebfffeffd97ff8cfd6fffeffe9c001df3afffeffe2c0056f3efffea20780027fff810164a308800100b203840100000135933712a6e80002a77780a8f5d84a86b2f6ecfd0fa6c75a56e14256f0accf089b6adb17d9e2ccfcaa484e7bc3319abbd66f8719d2c454cef7164d9f12e59522f9a8c1b32fa29626",
		"020102ae864dbb48103e12022081093082010580010281261368665f0285fc194c692bce447885093dffffffffe00435ba7fffff07d18100000800000000a281cda181c1820117a381bb8381b800a27fcb7f19fffe01657fbfdf48fffe018cbfbeef59fffe000c3fb00fe1fffe0040ffdc7f90fffeffef7fcf502afffe003fffcd903dfffe00acffa9c011fffeffddffd6100cfffeffec3fbdc002fffe005a3fc54f6cfffe00b07fcbff7ffffe00ef3fb34f84fffe012abfb09f07fffe0014ffadbf7cfffe0002bfdc4f73fffe01b0bf9f8f0cfffe00453feb1fb9fffeffa0401d2feefffeff9580267febfffeffea7ff38fd6fffefffafffc9f3afffefff3c0002f3efffea20780027fff810164a308800100b203840100000135933741f3120002f5e1678452fe92fa4e3c4373030627bc85000937c93eb26ad939600a7e05f29fead9407ace761225f0e920a1e5e918c154d657cdff63cb72a902d2f2b757c9bd",
		"020102ae864dbb48103e12022081093082010580010281265f68665f02a3ac194c694fce447855094bffffffffe00435ba7ffffd07d18100000800000000a281cda181c1820117a381bb8381b800ab7fc87f26fffe016e7fbcdf55fffe0195bfbbef66fffe00153fad0feefffe0049ffd97f9dfffefff87fcc5037fffe0048ffca904afffe00b5ffa6c01efffeffe6ffd31019fffefff53fbac00ffffe00633fc24f79fffe00b97fc8ff8cfffe00f83fb04f91fffe0133bfad9f14fffe001dffaabf89fffe000bbfd94f80fffe01b9bf9c8f19fffe004e3fe81fc6fffeffa9401a2ffbfffeff9e80237ff8fffefff37ff08fe3fffe0003fff99f47fffefffcfffd2f4bfffea20780027fff810164a308800100b2038401000001359337b5e985000399b3d7ba98e746422581b49fc6ded7a86a2ec49102572b7073f995e0a5631f336d35aae6063179743f447dd303fb3714db0887c897e81bb37e56132967ee996c",
		"020102ae864dbb48103e12022081093082010580010281266968665f02a794194c693ace44786c0954ffffffffe00635ba7f001607d18100000800000000a281cda181c1820117a381bb8381b800a63fc9ef2ffffe01693fbe4f5efffe01907fbd5f6ffffe000fffae7ff7fffe0044bfdaefa6fffefff33fcdc040fffe0043bfcc0053fffe00b0bfa83027fffeffe1bfd48022fffeffefffbc3018fffe005dffc3bf82fffe00b43fca6f95fffe00f2ffb1bf9afffe012e7faf0f1dfffe0018bfac2f92fffe00067fdabf89fffe01b47f9dff22fffe0048ffe98fcffffeffa4001b9004fffeff994024e001fffeffee3ff1ffecfffefffebffb0f50fffefff7bffe9f54fffea20780027fff810164a308800100b2038401000001359337c52b58000273b819a4bea25d73a62fdb5ef7b06b2732a1146271ba9271a3abf1d351cd7d5d66e4d069886ec6ce1e60c87244bcec6423b9d65e038cc26d0ba6446b3572192f",
		"020103030003af58634513be7ffb011200000566000000ac0cb87c12d590f1ed09e101022000041449cf38014a000000010218ba16a53e7e612febb0719ab3aa6293f19e8a81a1b702aa765fb38e07015e3b022081093082010580010281267e68665f027dc8194c690ece4478ae093dffffffffe00235ba7f000607d18100000800000000a281cda181c1820117a381bb8381b8009b3fce0f18fffe015e3fc26f47fffe01857fc17f58fffe0004ffb29fe0fffe0039bfdf0f8ffffeffe83fd1e029fffe0038bfd0203cfffe00a5bfac5010fffeffd6bfd8a00bfffeffe4ffc05001fffe0052ffc7df6bfffe00a93fce8f7efffe00e7ffb5df83fffe01237fb32f06fffe000dbfb04f7bfffefffb7fdedf72fffe01a97fa21f0bfffe003dffedafb8fffeff99001fbfedfffeff8e40290feafffeffe33ff61fd5fffefff3bfff2f39fffeffec8002bf3dfffea20780027fff810164a308800100b203840100000135933722143400033d03930d9a399cf58bf72071154592532ed9122abe0e59342a634f1cc4417d7e5e3dd00b1dabaf920d7bdd12cd12723b2c2feb786b6f22f9f1d502d521d15417",
		"020103030003af58634513be7ffb011200000566000000ac0cb87c12d590f1ed09e101022000041449cf38014a000000010218ba16a53e7e612febb0719ab3aa6293f19e8a81a1b702aa765fb38e07015e3b022081093082010580010281261c68665f028980194c6923ce447886093dffffffffe00635ba7f001007d18100000800000000a281cda181c1820117a381bb8381b800a07fcb8f19fffe01637fbfef48fffe018abfbeff59fffe000a3fb01fe1fffe003effdc8f90fffeffed7fcf602afffe003dffcda03dfffe00aaffa9d011fffeffdbffd6200cfffeffea3fbdd002fffe00583fc55f6cfffe00ae7fcc0f7ffffe00ed3fb35f84fffe0128bfb0af07fffe0012ffadcf7cfffe0000bfdc5f73fffe01aebf9f9f0cfffe00433feb2fb9fffeff9e401d3feefffeff9380268febfffeffe87ff39fd6fffefff8fffcaf3afffefff1c0003f3efffea20780027fff810164a308800100b20384010000013593374fae6000023a3df8eebf79c67fb58ff7ac9e1f89a2b2767212b0f15aa7564fbe7e814a4f5b7e2062bd529b8d9035faed2b66075256be106c20e892592aad0b307c9cbcf789",
		"020102ae864dbb48103e12022081083082010480010281261d68665f0289e4194c6921ce447887093dffffffffe00635ba7f001007d18100000800000000a281cca181c1820117a381bb8381b8009fffcb9f19fffe0162ffbfff48fffe018a3fbf0f59fffe0009bfb02fe1fffe003e7fdc9f90fffeffecffcf702afffe003d7fcdb03dfffe00aa7fa9e011fffeffdb7fd6300cfffeffe9bfbde002fffe0057bfc56f6cfffe00adffcc1f7ffffe00ecbfb36f84fffe01283fb0bf07fffe00127faddf7cfffe00003fdc6f73fffe01ae3f9faf0cfffe0042bfeb3fb9fffeff9dc01d4feefffeff9300269febfffeffe7fff3afd6fffefff87ffcbf3afffefff140004f3efffea206800100810100a308800100b203840100000135933751359f0002f2807bb6f8e12b084ea9b264e2ce5e24c42ab9e5454cea841f39f018b982d8585e79a18853360a801644af40e298b7eaec80bf208d138b034c9762c68ad83323",
		"020102ae864dbb48103e12022081083082010480010281261e68665f028a48194c6923ce447886093dffffffffe00735ba7f000607d18100000800000000a281cca181c1820117a381bb8381b800a07fcb8f18fffe01637fbfef47fffe018abfbeff58fffe000a3fb01fe0fffe003effdc8f8ffffeffed7fcf6029fffe003dffcda03cfffe00aaffa9d010fffeffdbffd6200bfffeffea3fbdd001fffe00583fc55f6bfffe00ae7fcc0f7efffe00ed3fb35f83fffe0128bfb0af06fffe0012ffadcf7bfffe0000bfdc5f72fffe01aebf9f9f0bfffe00433feb2fb8fffeff9e401d3fedfffeff9380268feafffeffe87ff39fd5fffefff8fffcaf39fffefff1c0003f3dfffea206800100810100a308800100b203840100000135933752bbda0003a41352804d6ce1135ef68e8183fbfecbeab5e1d5db270cc00dbc039bffd6215c084edcd7aa1117450daed3eef8e18e5870ad46fe2a2947e1578942d3ae61bdfb",

		// Arada -- payload BSM is valid
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff05f305d800107810164a551304f81020c21a20c8004194c75a28104ce448608a73b3039a237810101a232303080010281020bb882010ea3240404fc51fa530404fcbcfb100404fcf5fb5d0404fd2ffb7f0404fd60fb950404fd1efbf98702bc6c00013857ffba7202000100013857ffc9b400d7a47194e6eb03aa86102b6bb5faac55aad57b96d11e15ba5e1f120ce5f610bfd8641707f334a440d1540e284337a330aeb64637ecf9d5f34fce108fef384e9d",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff0408701003a01010e020400000c210308194c75a2ce448608040101050204010602000e0802019009150002e6ffbb13a4fdfe0c1a008f00f500e5010101b4ff308d00013857ffc7c413000100013857ffd70600ed6526e40c509dc34759465ccf56e4ff0e52693242bd0fb67973f47e67aff005dd4d4518e3061d4e6619d60eaea4577ee430d146deda6a5dd6ff5d336017683b",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff0408701003a01010e020400000c210308194c75a2ce448608040101050204010602000e0802019009150002e6ffbb13a4fdfe0c1a008f00f500e5010101b4ff308d00013857ffd70f6c000100013857ffe651007440d29f6095afb5dbce83984d8a57fd84f2c35d491b956f88de66b6c0e6f10f0ce343c5e259d50d0f7d2cead6d1a4d5d50b007d33c3f62cd5597458cb5924da",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff05f305d800107810164a551304f81020c21a20c8004194c75a28104ce448608a73b3039a237810101a232303080010281020bb882010ea3240404fc51fa530404fcbcfb100404fcf5fb5d0404fd2ffb7f0404fd60fb950404fd1efbf98702bc6c00013857ffd8f683000100013857ffe83800d097fd33ed087a897925b18479ba7bd35bd5c19afe8c5212d96bf01d5fe77cb9c53d52eba6919a057c277f30714f8787480e3398ceada84402f1fcf27b8588fd",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff0408701003a01010e020400000c210308194c75a2ce448608040101050204010602000e0802019009150002e6ffbb13a4fdfe0c1a008f00f500e5010101b4ff308d00013857ffe65aff000100013857fff59d00504e3a6d8c1b32282e7104777586ce2cb5f09688793421a29daeb85329008659952eb4c7290a82023d938c081d09b3c564928f9e585dc1dc6908b65dea649e4e",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff05f305d800107810164a551304f81020c21a20c8004194c75a28104ce448608a73b3039a237810101a232303080010281020bb882010ea3240404fc51fa530404fcbcfb100404fcf5fb5d0404fd2ffb7f0404fd60fb950404fd1efbf98702bc6c00013857ffe838bb000100013857fff77b00fd5d0fe8c1290289ac62649cd22517ec37467cb08914993d3ae4c51b40c57400c6cbaedf225fd68256fb4cf31d1dc6b579096e81d336e6ae441df59825bd2a7e",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff0408701003a01010e020400000c210308194c75a2ce448608040101050204010602000e0802019009150002e6ffbb13a4fdfe0c1a008f00f500e5010101b4ff308d00013857fff59a580001000138580004dc0028c5fe0f520c1682bdeb7db0834f119d56b3212b4d31e6335c9381bd0155db2eef82ad965b7b1ae52eecf311a7b9578447896a247cc27a95b05c7b1da7adfd91",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff05f305d800107810164a551304f81020c21a20c8004194c75a28104ce448608a73b3039a237810101a232303080010281020bb882010ea3240404fc51fa530404fcbcfb100404fcf5fb5d0404fd2ffb7f0404fd60fb950404fd1efbf98702bc6c00013857ffc9b445000100013857ffd8f60063f06146213b4f8f0c55aecd7136c0f0565ddbcbca1b501b127c9b81a61e7b9ab65879f43f765e76e81a0d731e4bddb942f4a771e5d43f326cc4b47e5ab9a7c2",
		
		// Cohda file: arada messages
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff05f305d800107810164a551304f81020c21a20c8004194c75a28104ce448608a73b3039a237810101a232303080010281020bb882010ea3240404fc51fa530404fcbcfb100404fcf5fb5d0404fd2ffb7f0404fd60fb950404fd1efbf98702bc6c000138586a1f372e0001000138586a2e790065d7d2ad34856e6dad6e6546adc6b8ba99cf2ce7a5d6ed536f770853c5550199ac7d47180692c21572fda5d4ed27d769f9d2888afc8fd00d6fb936df63da5132",
		"020103030201af58634513be7ffb01000103bff000041c35f8de137dfd5e00000001039989e63a40d7033304001ac50776c76fe4d6378b1837aed2916c36cdcf40ac2306bff0408701003a01010e020400000c210308194c75a2ce448608040101050204010602000e0802019009150002e6ffbb13a4fdfe0c1a008f00f500e5010101b4ff308d000138586a2c5e680001000138586a3ba0004f28c8b8e48f80f2ec300aa770eef11bce7e4c553b2f2caf1d8e8014b42e3c1cef98740ebf2ce78e97c5a775f241dab53f74f767e553dde278ace7dc30ce3f68",
		
		// Cohda file: not arada -- fail signature payload looks funky too
		//"02010303000333f522fa83173d8901128000000100000000bc10985d8d1ab9b2fc1701022000041872407b61b6000000010356673a91e2dc43fe6b95dbb848b7078cbbe368a240ed8b5ffd48c6fe0a75a8b302207d307b8001028126127baf78550000194c69d4ce447a6608a3ffffffffe00070807fffec07d12b7fff0000000000a236a134a023a015800207de81010b82011283011484011d850300e8088104ce447a668204194c69d4820101a30a830800138053afff0a9fa316b114800100a106800100810100820100830100840100000138586a290be60003b5cfd9c737a9e931dbca9fbfdbca4f2c23a0210ef5c096bcf60912ae9550ce1ad2634a9bb9464e6ab090485d7cb9040088499ea3460bce82496da245a4c86f5d",
		//"02010303000333f522fa83173d8901128000000100000000bc10985d8d1ab9b2fc1701022000041872407b61b6000000010356673a91e2dc43fe6b95dbb848b7078cbbe368a240ed8b5ffd48c6fe0a75a8b302207c307a8001028126397baf78550f3c194c690ace447a2d08a4ffffffffe00370807f000107d12b7fff0000000000a235a133a022a014800207de81010b82011283011484011e85020c808104ce447a2d8204194c6907820101a30a8308ffe0405020000c1ba316b114800100a106800100810100820100830100840100000138586a648e5e0002c0d54f6b4e1cfabffea70e5b7b14e9e52f690238a73eadaf3bcbbc061d8028a0bd1c0c6e370ced577c1573cdbbbcbbaf1b1c656d0e518063e72cace7c95749c8",
		
		// Savari - payload BSM is valid
		"020103030003af58634513be7ffb01128000000100000000bc75d24eb15afb5a4bd601022000041872407b61b6000000010224c1a4fb86ff084547e0ef5811147da42c2fbdfed4f4fca5618b786685be2ba20220810430820100800102812622c5720123a604194c688ece447cd50977ffffffffe00663af7ffffb07d132009108003201f4a281bda181b1820115a381ab8381a80035000cbff70eed003f80099ff90f01001a4017affe222f0012001a4ffd2239ffb4404fef8b3387ffc4004f8f87343bfe34007d8f847c11fe40807adf817c75ff77c0190fcda1ebff8600154fcca30303017f1520ddcf0902f43f1930dbcf6d01fc3f62d060d535000080152f63fffe000e4011ff62fffe0056fffd101bfffeffad402c3fcefffe000e400f7fa0fffe01ffffe27fe3fffe0212bfdfdfe1fffeff6ec0214fbbfffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa41daa60e03b78f53aaa512f1755a1e61c83d806ea24fe7342f660fb02e5597ad23354e2df43c9c50ac9a72fd1e304936fef52eb07cc93f2ab0f0e2bdc5a79fa8180d40d594",
		"0201021a0d7fe21f249e570220810430820100800102812623c5720123a668194c6887ce447cdf0975ffffffffe00863af7fffff07d13200a208003201f4a281bda181b1820115a381ab8381a80033400d5ff60ef6003dc00a3ff80f0a001880184ffd22380010401aeffc2242ffb280508f8a3390ffc240502f863444fe32407e2f837c1afe3ec07b7f807c7eff760019afcca1f4ff844015efcba30c02ffbf15c0dccf1202f27f19d0dacf7601fa7f63705fd53efffec015cf62fffe000c80129f61fffe00553ffdb01afffeffab802cdfcdfffe000c80101f9ffffe01fe3fe31fe2fffe0210ffe07fe0fffeff6d0021efbafffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa43354d0e03848e859c394e3bfca6a182d1acf2b5b451a0d66984c5058d07fe2624b17304bc886a62c9fbfb253cf8e4dc6fef539441256ab8dd7bf18034248980b21f639b2e",
		"0201021a0d7fe21f249e570220810430820100800102812624c5720123a6cc194c6880ce447cea0975ffffffffe00863af7f000007d132008a08003201f4a281bda181b1820115a381ab8381a80031800dfff60f01003c000adff80f150016c018effd2243000e801b8ffc224dffb0c0512f8a339bffc08050cf86344ffe30807ecf837c25fe3d007c1f807c89ff74401a4fcca1ffff8280168fcba31702fdff1660dccf1d02f0bf1a70dacf8101f8bf64105fd549fffd00166f62fffe000ac0133f61fffe00537ffe501afffeffa9c02d7fcdfffe000ac010bf9ffffe01fc7fe3bfe2fffe020f3fe11fe0fffeff6b40228fbafffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa44e6e30e0235a42f89f8bc931ff1c660d115e4d4457560709aa01273a9c0de4615f38f1afe7ee97cb68e6cd159c2e46a8f28e847655a9b5091ac59dbc492a76cdbce94df55",
		"0201021a0d7fe21f249e570220810430820100800102812625c5720123a730194c687dce447cf10975ffffffffe00763af7fffff07d132006408003201f4a281bda181b1820115a381ab8381a80030c00e6ff60f0a003b400b4ff80f1e001600195ffd224c000dc01bfffc2256ffb000519f8a33a4ffbfc0513f863458fe2fc07f3f837c2efe3c407c8f807c92ff73801abfcca208ff81c016ffcba32002fd3f16d0dccf2602efff1ae0dacf8a01f7ff64805fd552fffc4016df62fffe000a0013af61fffe0052bffec01afffeffa9002defcdfffe000a00112f9ffffe01fbbfe42fe2fffe020e7fe18fe0fffeff6a8022ffbafffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa4649930e02954a048d1a70cb8dbe388b62285daa54cb7f3097ead8a1b50f150a676b39a511324456e2d24821dc27fffc438abd6b47c50c63212b142635b0527918fb78f5f6",
		"0201021a0d7fe21f249e570220810430820100800102812626c5720123a794194c6875ce447cfb0974ffffffffe00863af7f000107d132003d08003201f4a281bda181b1820115a381ab8381a8002ec00f1ff50f140039400bfff70f280014001a0ffc2256000bc01caffb2261ffae00524f8933afffbdc051ef853463fe2dc07fef827c39fe3a407d3f7f7c9dff71801b6fcba213ff7fc017afcaa32a02fb3f1780dbcf3102edff1b90d9cf9501f5ff65305ed55cfffa40178f61fffe000800145f60fffe0050bfff7019fffeffa7002e9fccfffe00080011df9efffe01f9bfe4dfe1fffe020c7fe23fdffffeff688023afb9fffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa47e8c10e037612d68a331088b8421481a1110161f47a8040fde70fbf2b7a441bf0c7620ee3712ac4b99590e0408ea0857051c9530345a894f129be643bf630d6aff20d1639",
		"0201021a0d7fe21f249e570220810430820100800102812627c5720123a7f8194c686ece447d050974ffffffffe00a63af7f000807d132001e08003201f4a281bda181b1820115a381ab8381a8002d000fbff50f1e0037800c9ff70f320012401aaffc2260000a001d4ffb226affac4052ef8933b8ffbc00528f85346cfe2c00808f827c42fe38807ddf7f7ca6ff6fc01c0fcba21cff7e00184fcaa33402f97f1820dbcf3a02ec3f1c30d9cf9e01f43f65d05ed566fff880182f61fffe00064014ff60fffe004ec0001019fffeffa5402f3fccfffe000640127f9efffe01f7ffe57fe1fffe020abfe2dfdffffeff66c0244fb9fffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa4963c40e02ec8616f9ea550f88e605c34ca713e8b1e5a412af76c2a6f6b9f1c57d3e99419a8d46a716e03cf33e765e442094cf6e0dd468f37085320f409bcd1c530653021d",
		"020103030003af58634513be7ffb01128000000100000000bc75d24eb15afb5a4bd601022000041872407b61b6000000010224c1a4fb86ff084547e0ef5811147da42c2fbdfed4f4fca5618b786685be2ba20220810430820100800102812617c5720123a1b8194c68b1ce447c91097affffffffe00f63af7f001307d132215b08003201f4a281bda181b1820115a381ab8381a8003dc0087ffb0e7f004840055ffd0e9300230013600221c1001ac016000121cbffbd004baf8f3319ffccc04b4f8b33cdfe3cc0794f887ba3fe4940769f857c07ff808014cfd1a17dff8ec0110fd0a295030a3f10e0e1ce9b02fcff14f0dfceff0204ff5e9064d4c700094010ef67fffe0017000dbf66fffe005fbff8d01ffffeffb60027ffd2fffe0017000b3fa4fffe0208bfde3fe7fffe021b7fdb9fe5fffeff77801d0fbffffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa3116d20e025e71289897400e9d506ba7ff7fc9acfe58c293846e8beb00065555b915a69ad540bc5bacffe3b2eb4a14703559efcc69a7abedf0b65c8b0817c33ec43dfbf990",
		"0201021a0d7fe21f249e570220810430820100800102812618c5720123a21c194c68aace447c9b0979ffffffffe00e63af7f000e07d13209fa08003201f4a281bda181b1820115a381ab8381a8003c00091ffa0e8800468005fffc0e9c00214014000121ca00190016a00021d4ffbb404c4f8e3322ffcb004bef8a33d6fe3b0079ef877bacfe4780773f847c10ff7ec0156fd0a186ff8d0011afcfa29e03087f1180e0cea402fb3f1590decf0802033f5f3063d4d0000780118f66fffe0015400e5f65fffe005dfff9701efffeffb440289fd1fffe0015400bdfa3fffe0206ffdedfe6fffe0219bfdc3fe4fffeff75c01dafbefffea20780027fff810100bf81001180011ea10680012b81012b82012284010400013857fa3287e00e03c8da25de117bd2f16892979a963410699047f36d267559d8be71e4fd738ad20be545bb500c85037c1ca9452f8cafc7db0865ef80c7d4b91a5a75c169a6c71a4c",
    };
    
	
	@BeforeClass
	public static void setUpBeforeClass() throws Exception {
		UnitTestHelper.initLog4j(isDebugOutput);
		CryptoProvider.initialize();
		
		ClockHelperTest.setNow(certsValidDate);
	}

	@Before
	public void setUp() throws Exception {
		addCertificate("CA", CaCert);
		addCertificate("RA", RaCert);
	}
	
	private void addCertificate(String name, String hexCert) throws CertificateException, DecoderException {
		byte[] certBytes = Hex.decodeHex(hexCert.toCharArray());
    	Certificate cert = Certificate.fromBytes(new CryptoProvider(), certBytes);
    	assertNotNull(cert);
    	assertTrue(cert.isValid());
    	CertificateManager.put(name, cert);
	}

	@After
	public void tearDown() throws Exception {
		CertificateManager.clear();
	}

	@Test
	public void test() throws MessageException, CertificateException, VectorException, CryptoException, DecoderException {
		int i = 0;
		for( String message : messages) {
			test(++i, message);
		}
	}
	
	private void test(int id, String message) throws MessageException, CertificateException, VectorException, CryptoException, DecoderException {
		log.debug("--------------------------------  Message no. " + id + " --------------------------------");
		byte[] bytes = Hex.decodeHex(message.toCharArray());
		IEEE1609p2Message msg = IEEE1609p2Message.parse(bytes);
		Certificate cert = msg.getCertificate();
		log.debug("PSID:            " + msg.getPSID());
		log.debug("Certificate:     " + Hex.encodeHexString(cert.getBytes()));
		log.debug("Generation Time: " + msg.getGenerationTime());
		log.debug("Payload:         " + Hex.encodeHexString(msg.getPayload()));
	}

}
